# ğŸ“ ARQUITECTURA VISUAL - CLARIDATA ETL

**Diagramas del Sistema** - VisiÃ³n tÃ©cnica completa  

---

## ğŸ¯ FLUJO GENERAL (Usuario â†’ BD â†’ Dashboards)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USUARIO                                   â”‚
â”‚                  (PyME - Cualquier navegador)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    FRONTEND REACT + TYPESCRIPT        â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚  Componente FileUpload         â”‚  â”‚
        â”‚  â”‚  - Drag & drop                 â”‚  â”‚
        â”‚  â”‚  - ValidaciÃ³n de extensiÃ³n    â”‚  â”‚
        â”‚  â”‚  - Progress bar               â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚  Componente ErrorDisplay       â”‚  â”‚
        â”‚  â”‚  - Tabla de errores           â”‚  â”‚
        â”‚  â”‚  - Fila + Columna + SoluciÃ³n  â”‚  â”‚
        â”‚  â”‚  - BotÃ³n descargar archivo    â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ POST /api/import/excel
                            â”‚ (form-data: archivo.xlsx)
                            â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚        BACKEND C# - ASP.NET CORE                  â”‚
        â”‚                                                  â”‚
        â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚   â”‚  ImportController                       â”‚   â”‚
        â”‚   â”‚  - ValidarArchivoExcel()               â”‚   â”‚
        â”‚   â”‚  - OrcuestarCarga()                     â”‚   â”‚
        â”‚   â”‚  - RetornarReporte()                    â”‚   â”‚
        â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚                    â–¼                             â”‚
        â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚   â”‚  ExcelValidationService                 â”‚   â”‚
        â”‚   â”‚  â”œâ”€ ValidarEstructura()                â”‚   â”‚
        â”‚   â”‚  â”œâ”€ LeerYMapearProductos()             â”‚   â”‚
        â”‚   â”‚  â”œâ”€ LeerYMapearInventario()            â”‚   â”‚
        â”‚   â”‚  â”œâ”€ LeerYMapearVentas()                â”‚   â”‚
        â”‚   â”‚  â””â”€ LeerYMapearFinancieros()           â”‚   â”‚
        â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚                    â–¼                             â”‚
        â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚   â”‚  DataTransformationService              â”‚   â”‚
        â”‚   â”‚  â”œâ”€ ParseDate()                        â”‚   â”‚
        â”‚   â”‚  â”œâ”€ ParseCurrency()                    â”‚   â”‚
        â”‚   â”‚  â”œâ”€ ParseBoolean()                     â”‚   â”‚
        â”‚   â”‚  â””â”€ NormalizeText()                    â”‚   â”‚
        â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚                    â–¼                             â”‚
        â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚   â”‚  DatabaseLoaderService                  â”‚   â”‚
        â”‚   â”‚  BEGIN TRANSACTION (SERIALIZABLE)       â”‚   â”‚
        â”‚   â”‚  â”œâ”€ UpsertProductos()                  â”‚   â”‚
        â”‚   â”‚  â”œâ”€ InsertInventarios()                â”‚   â”‚
        â”‚   â”‚  â”œâ”€ InsertVentas() + Detalles          â”‚   â”‚
        â”‚   â”‚  â””â”€ InsertFinancieros()                â”‚   â”‚
        â”‚   â”‚  COMMIT or ROLLBACK                     â”‚   â”‚
        â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚                    â–¼                             â”‚
        â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚   â”‚  ImportLogService                       â”‚   â”‚
        â”‚   â”‚  â”œâ”€ RegistrarCarga()                   â”‚   â”‚
        â”‚   â”‚  â”œâ”€ RegistrarAudit()                   â”‚   â”‚
        â”‚   â”‚  â””â”€ GenerarReporte()                   â”‚   â”‚
        â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚                                                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚        PostgreSQL (Data Warehouse)               â”‚
        â”‚                                                  â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚  importaciones_datos (Logs)              â”‚   â”‚
        â”‚  â”‚  audit_cambios (Cambios histÃ³ricos)     â”‚   â”‚
        â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
        â”‚  â”‚  productos (Maestro)                     â”‚   â”‚
        â”‚  â”‚  inventario (Stock)                      â”‚   â”‚
        â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
        â”‚  â”‚  ventas (Transacciones)                  â”‚   â”‚
        â”‚  â”‚  detalles_venta (LÃ­neas)                â”‚   â”‚
        â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
        â”‚  â”‚  datos_financieros (Movimientos)         â”‚   â”‚
        â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
        â”‚  â”‚  Ãndices: ON productos, ON ventas(fecha)â”‚   â”‚
        â”‚  â”‚  Constraints: FK, CHECK, UNIQUE         â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚                                                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   FRONTEND - DASHBOARDS (Tiempo Real)            â”‚
        â”‚                                                  â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
        â”‚  â”‚ Dashboard    â”‚  â”‚ Dashboard    â”‚             â”‚
        â”‚  â”‚ VENTAS       â”‚  â”‚ FINANCIEROS  â”‚             â”‚
        â”‚  â”‚              â”‚  â”‚              â”‚             â”‚
        â”‚  â”‚ KPIs:        â”‚  â”‚ KPIs:        â”‚             â”‚
        â”‚  â”‚ - Total $    â”‚  â”‚ - Ingresos   â”‚             â”‚
        â”‚  â”‚ - Ã“rdenes    â”‚  â”‚ - Gastos     â”‚             â”‚
        â”‚  â”‚ - Margen     â”‚  â”‚ - Utilidad   â”‚             â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
        â”‚  â”‚ Dashboard    â”‚  â”‚ Dashboard    â”‚             â”‚
        â”‚  â”‚ INVENTARIO   â”‚  â”‚ OPERACIONES  â”‚             â”‚
        â”‚  â”‚              â”‚  â”‚              â”‚             â”‚
        â”‚  â”‚ KPIs:        â”‚  â”‚ KPIs:        â”‚             â”‚
        â”‚  â”‚ - Stock $    â”‚  â”‚ - Ã“rdenes    â”‚             â”‚
        â”‚  â”‚ - Productos  â”‚  â”‚ - Cumplimiento
        â”‚  â”‚ - Alertas    â”‚  â”‚ - Entrega    â”‚             â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
        â”‚                                                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ CICLO DE VALIDACIÃ“N (4 Fases)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ARCHIVO EXCEL CARGADO                        â”‚
â”‚              (claridata_datos_202501_ACME.xlsx)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  FASE 1: VALIDACIÃ“N INICIAL                â”‚
     â”‚  âŒ Si falla â†’ RECHAZAR TODO               â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚  âœ“ ExtensiÃ³n = .xlsx                      â”‚
     â”‚  âœ“ TamaÃ±o <= 10 MB                        â”‚
     â”‚  âœ“ Archivo vÃ¡lido (OpenXML)               â”‚
     â”‚  âœ“ 4 hojas presentes                      â”‚
     â”‚  âœ“ Columnas obligatorias                  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  FASE 2: LECTURA & MAPEO                   â”‚
     â”‚  âŒ Si falla â†’ RECHAZAR TODO               â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                                           â”‚
     â”‚  2.1 PRODUCTOS                            â”‚
     â”‚  â”œâ”€ Parse datos (cÃ³digo, nombre, precio) â”‚
     â”‚  â”œâ”€ Validar: Ãºnico, rango, tipo          â”‚
     â”‚  â””â”€ Crear DTO[]                          â”‚
     â”‚      âŒ Si error â†’ RECHAZAR               â”‚
     â”‚                                           â”‚
     â”‚  2.2 INVENTARIO                           â”‚
     â”‚  â”œâ”€ Parse datos (cantidad, stock)        â”‚
     â”‚  â”œâ”€ Validar: existe en PRODUCTOS         â”‚
     â”‚  â””â”€ Crear DTO[]                          â”‚
     â”‚      âŒ Si error â†’ RECHAZAR               â”‚
     â”‚                                           â”‚
     â”‚  2.3 VENTAS                               â”‚
     â”‚  â”œâ”€ Parse datos (orden, montos)          â”‚
     â”‚  â”œâ”€ Validar: coherencia, fechas          â”‚
     â”‚  â””â”€ Crear DTO[]                          â”‚
     â”‚      âŒ Si error â†’ RECHAZAR               â”‚
     â”‚                                           â”‚
     â”‚  2.4 FINANCIEROS                          â”‚
     â”‚  â”œâ”€ Parse datos (tipo, monto)            â”‚
     â”‚  â”œâ”€ Validar: categorÃ­a vÃ¡lida            â”‚
     â”‚  â””â”€ Crear DTO[]                          â”‚
     â”‚      âŒ Si error â†’ RECHAZAR               â”‚
     â”‚                                           â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  FASE 3: CARGA ATÃ“MICA (BD)               â”‚
     â”‚  âŒ Si falla â†’ ROLLBACK COMPLETO          â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚  BEGIN TRANSACTION (SERIALIZABLE)         â”‚
     â”‚  â”œâ”€ INSERT/UPDATE productos               â”‚
     â”‚  â”œâ”€ INSERT inventario                     â”‚
     â”‚  â”œâ”€ INSERT ventas + detalles              â”‚
     â”‚  â”œâ”€ INSERT datos_financieros              â”‚
     â”‚  â””â”€ COMMIT (Ã©xito) o ROLLBACK (error)     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  FASE 4: LOGS & REPORTE                   â”‚
     â”‚  (SIEMPRE se ejecuta, incluso si fallÃ³)   â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚  âœ“ INSERT en importaciones_datos          â”‚
     â”‚  âœ“ INSERT en audit_cambios                â”‚
     â”‚  âœ“ Generar reporte JSON/HTML              â”‚
     â”‚  âœ“ Notificar al usuario                   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  RESPUESTA AL USUARIO   â”‚
            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            â”‚  âœ… Exitoso:           â”‚
            â”‚  "Cargados 250 datos"  â”‚
            â”‚                        â”‚
            â”‚  âŒ Fallido:           â”‚
            â”‚  "Fila 5: error X"     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š ESTRUCTURA DE BASE DE DATOS (Impacto de Carga)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           TABLA: importaciones_datos (Log)                 â”‚
â”‚  Crecimiento: 1 fila por carga (no por registro)          â”‚
â”‚  TamaÃ±o esperado: ~100 bytes por fila                     â”‚
â”‚  Ejemplo: 100 cargas/mes Ã— 100 bytes = 10 KB/mes         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   TABLAS DE DATOS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  productos                  inventario                 â”‚
â”‚  â”œâ”€ Crecimiento: INSERT+UPDATE    â”œâ”€ FK â†’ productos   â”‚
â”‚  â”œâ”€ Esperado: +100-500/carga      â”œâ”€ Crecimiento: +50 â”‚
â”‚  â”œâ”€ Ãndices: codigo (UNIQUE)      â””â”€ Ãndice: estado   â”‚
â”‚  â””â”€ Ãndice: ON empresa                                 â”‚
â”‚                                                         â”‚
â”‚  ventas                     detalles_venta             â”‚
â”‚  â”œâ”€ Crecimiento: INSERT     â”œâ”€ FK â†’ ventas, productosâ”‚
â”‚  â”œâ”€ Esperado: +100-200/carga    â”œâ”€ Crecimiento: +200 â”‚
â”‚  â”œâ”€ Ãndice: numero_orden        â””â”€ Ãndice: venta_id  â”‚
â”‚  â””â”€ Ãndice: fecha (mes)         & producto_id         â”‚
â”‚                                                         â”‚
â”‚  datos_financieros                                      â”‚
â”‚  â”œâ”€ Crecimiento: INSERT                                â”‚
â”‚  â”œâ”€ Esperado: +50-100/carga                            â”‚
â”‚  â”œâ”€ Ãndices: tipo, fecha, anio_mes                     â”‚
â”‚  â””â”€ Particionar por AÃ‘O (si > 1M filas)                â”‚
â”‚                                                         â”‚
â”‚  audit_cambios (si hay updates)                         â”‚
â”‚  â”œâ”€ Crecimiento: 1 fila por campo modificado           â”‚
â”‚  â”œâ”€ Esperado: +10-50/carga                             â”‚
â”‚  â””â”€ Ãndice: producto_id, fecha_cambio                  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ TRANSACCIÃ“N ATÃ“MICA (Secuencia Temporal)

```
Tiempo:  Evento
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

T0       Usuario sube archivo
         â†“ POST /api/import/excel

T1       Backend recibe, valida estructura
         â”œâ”€ .xlsx? âœ“
         â”œâ”€ 4 hojas? âœ“
         â”œâ”€ Columnas? âœ“
         â””â”€ OK â†’ Continuar

T2-T4    Backend procesa cada hoja
         â”œâ”€ T2.1: Lee PRODUCTOS (100 filas)
         â”œâ”€ T2.2: Valida PRODUCTOS (20 errores encontrados)
         â”œâ”€ T2.3: âŒ RECHAZA â†’ Retorna errores al usuario
         â””â”€ Usuario corrige y reintenta

T5       Usuario sube correcciones
         â”œâ”€ T5.1: OK â†’ Continuar
         â”œâ”€ T5.2: Lee INVENTARIO (85 filas)
         â”œâ”€ T5.3: Valida INVENTARIO (OK)
         â””â”€ Continuar

T6       Lee VENTAS + FINANCIEROS (OK)
         â””â”€ Continuar

T7       BEGIN TRANSACTION (SERIALIZABLE)
         â””â”€ Punto de no retorno

T8-T11   Insertar en orden:
         â”œâ”€ T8:  INSERT INTO productos (85 nuevos, 10 updates)
         â”œâ”€ T9:  INSERT INTO inventario (85)
         â”œâ”€ T10: INSERT INTO ventas (50) + detalles (150)
         â””â”€ T11: INSERT INTO datos_financieros (30)

T12      Sin errores â†’ COMMIT
         â”œâ”€ Todas las inserciones persist
         â”œâ”€ Constraints validados
         â””â”€ TransacciÃ³n finalizada

T13      INSERT en importaciones_datos (log)
         â””â”€ Estado: "completado"

T14      Generar reporte JSON
         â”œâ”€ Registros cargados: 400
         â”œâ”€ DuraciÃ³n: 3.2 segundos
         â””â”€ Status: âœ… EXITOSO

T15      Respuesta al usuario
         â””â”€ Frontend muestra: "âœ… Carga exitosa"

T16      Dashboard actualiza en tiempo real
         â”œâ”€ GrÃ¡ficos se recalculan
         â”œâ”€ KPIs se actualizan
         â””â”€ Usuario ve datos nuevos
```

---

## ğŸ¯ MODELO DE DATOS RELACIONAL (Simplificado)

```
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚    empresas      â”‚
                     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                     â”‚  â”‚ id (PK)    â”‚  â”‚
                     â”‚  â”‚ nombre     â”‚  â”‚
                     â”‚  â”‚ sector     â”‚  â”‚
                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
        â–¼                     â–¼                     â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  productos  â”‚       â”‚ inventarioâ”‚        â”‚ datos_      â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚ financieros  â”‚
   â”‚ id (PK)     â”‚       â”‚ id (PK)   â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ empresa_id  â”‚       â”‚ prod_id   â”‚        â”‚ id (PK)      â”‚
   â”‚ codigo â—„â”€â”€â”€â”€â”¼â”€â”€â”€â”   â”‚ (FK)â—„â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â”   â”‚ empresa_id   â”‚
   â”‚ nombre      â”‚   â”‚   â”‚ cantidad  â”‚    â”‚   â”‚ tipo_dato    â”‚
   â”‚ precio      â”‚   â”‚   â”‚ stock_min â”‚    â”‚   â”‚ categoria    â”‚
   â”‚ costo       â”‚   â”‚   â”‚ ubicacion â”‚    â”‚   â”‚ monto        â”‚
   â”‚ activo      â”‚   â”‚   â”‚ activa    â”‚    â”‚   â”‚ fecha        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â–²            â”‚                     â”‚
        â”‚            â”‚                     â””â”€ NO depende de otros
        â”‚            â””â”€ Depende de PRODUCTOS
        â”‚
        â””â”€ MAESTRO
           (Base de todas las transacciones)
              â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    ventas    â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ id (PK)      â”‚
        â”‚ numero_orden â”‚
        â”‚ fecha        â”‚
        â”‚ cliente_id   â”‚
        â”‚ monto_total  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ 1:N
              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ detalles_venta   â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ id (PK)          â”‚
        â”‚ venta_id (FK)â”€â”€â”€â”€â”¤â”€â†’ ventas
        â”‚ producto_id (FK)-â”¼â”€â†’ productos
        â”‚ cantidad         â”‚
        â”‚ precio_unitario  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Relaciones:
â”â”â”â”â”â”â”â”
empresas (1) â”€â†’ (N) productos
empresas (1) â”€â†’ (N) inventario
empresas (1) â”€â†’ (N) ventas
ventas (1) â”€â†’ (N) detalles_venta
productos (1) â”€â†’ (N) detalles_venta
productos (1) â”€â†’ (1) inventario
```

---

## ğŸ“ˆ CRECIMIENTO ESPERADO DE BD (Por carga mensual)

```
Escenario: PyME mediana (100 clientes, 500 productos, 1000 ventas/mes)

Tabla              TamaÃ±o/carga    Total (12 meses)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
productos          +50 KB          +600 KB
inventario         +30 KB          +360 KB
ventas             +200 KB         +2.4 MB
detalles_venta     +500 KB         +6 MB
datos_financieros  +20 KB          +240 KB
importaciones_datos +1 KB (log)     +12 KB
audit_cambios      +10 KB          +120 KB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL              ~810 KB/mes     ~10 MB/aÃ±o

Ãndices: +30% del tamaÃ±o de datos
Total estimado con Ã­ndices: ~13 MB/aÃ±o

ConclusiÃ³n: Crece lentamente, fÃ¡cil de mantener en PostgreSQL
```

---

## ğŸ” SEGURIDAD & TRANSACCIONES

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         NIVELES DE VALIDACIÃ“N & SEGURIDAD        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  CAPA 1: FRONTEND                               â”‚
â”‚  â”œâ”€ ValidaciÃ³n de extensiÃ³n (.xlsx)            â”‚
â”‚  â”œâ”€ ValidaciÃ³n de tamaÃ±o (< 10 MB)             â”‚
â”‚  â””â”€ Mensaje amigable para usuario              â”‚
â”‚                                                 â”‚
â”‚  CAPA 2: BACKEND (ValidaciÃ³n)                   â”‚
â”‚  â”œâ”€ Verificar estructura Excel                 â”‚
â”‚  â”œâ”€ Parsear y normalizar datos                 â”‚
â”‚  â”œâ”€ Validar contra reglas de negocio           â”‚
â”‚  â”œâ”€ Prevenir SQL injection (parametrized)      â”‚
â”‚  â””â”€ Logging de intentos fallidos               â”‚
â”‚                                                 â”‚
â”‚  CAPA 3: BASE DE DATOS                          â”‚
â”‚  â”œâ”€ Constraints (FK, CHECK, UNIQUE)            â”‚
â”‚  â”œâ”€ Indexes para performance                   â”‚
â”‚  â”œâ”€ Transacciones SERIALIZABLE                 â”‚
â”‚  â”œâ”€ Audit trails (importaciones_datos)         â”‚
â”‚  â””â”€ EncriptaciÃ³n de datos sensibles            â”‚
â”‚                                                 â”‚
â”‚  CAPA 4: APLICACIÃ“N                             â”‚
â”‚  â”œâ”€ AutenticaciÃ³n (solo admin/owner)           â”‚
â”‚  â”œâ”€ Rate limiting (mÃ¡x 10 cargas/hora)         â”‚
â”‚  â”œâ”€ Logging de cambios (audit_cambios)         â”‚
â”‚  â””â”€ Alertas para patrones sospechosos         â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š IMPACTO EN DASHBOARDS (Post-Carga)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Datos nuevos en BD                      â”‚
â”‚  (Inmediatamente despuÃ©s de COMMIT)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚             â”‚             â”‚
         â–¼             â–¼             â–¼

Dashboard VENTAS   Dashboard INVENTARIO  Dashboard FINANCIEROS
â”œâ”€ KPI Total       â”œâ”€ Stock $             â”œâ”€ Ingresos
â”œâ”€ Ã“rdenes         â”œâ”€ Productos en stock  â”œâ”€ Gastos
â”œâ”€ Ticket promedio â”œâ”€ Productos crÃ­ticos  â”œâ”€ Utilidad
â”œâ”€ Top clientes    â”œâ”€ Movimientos (30d)   â”œâ”€ Margen
â””â”€ GrÃ¡ficos        â””â”€ RotaciÃ³n            â””â”€ Flujo

         â”‚             â”‚             â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Recalculan en <5 seg    â”‚
        â”‚  (Real-time queries)      â”‚
        â”‚                           â”‚
        â”‚  âœ“ Tablas se actualizan   â”‚
        â”‚  âœ“ GrÃ¡ficos se redibuan   â”‚
        â”‚  âœ“ Alertas se generan     â”‚
        â”‚  âœ“ IA recibe datos nuevos â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ CONCLUSIÃ“N: TODO CONECTADO

```
Usuario                          Backend                    BD
  â”‚                                â”‚                        â”‚
  â”œâ”€ Carga Excel              Backend valida,          TransacciÃ³n
  â”‚                           procesa, normaliza       atÃ³mica
  â””â”€â†’ Archivo (10 MB)             â”‚                        â”‚
       (4 hojas)             Parsers de fechas,        COMMIT o
       (1000+ registros)      monedas, booleanos      ROLLBACK
                                   â”‚                        â”‚
                              Si hay error         â† Rollback
                              â†’ Rechaza todo       completo
                                   â”‚                        â”‚
                              Si OK              â† INSERT
                              â†’ ContinÃºa         + UPDATE
                                   â”‚
                              RegistraLogs â”€â”€â”€â”€â†’ importaciones_datos
                                   â”‚
                              GeneraReporte
                                   â”‚
                              RetornaUser â”€â”€â”€â”€â”€â†’ Frontend
                                   â”‚
                              Dashboard      â† Lee datos nuevos
                              actualiza         (tiempo real)
```

---

**Documento Visual Completo - Apto para presentaciones tÃ©cnicas**
